{% extends "base.html" %}

{% block title %}–¢–æ–ø –∫–ª–∞–Ω–æ–≤ - –ë–∏—Ç–≤–∞ –∑–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é{% endblock %}

{% block extra_head %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; }
body { font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, 'Times New Roman', serif; }

.clans-top-page {
    min-height: 100vh;
    background: #3d2914 linear-gradient(180deg, rgba(61,41,20,0.97) 0%, #2c1810 50%, #1a0f08 100%);
    padding: 20px;
    color: #e8dcc4;
    position: relative;
}
.clans-top-page::before {
    content: '';
    position: fixed;
    inset: 0;
    background: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
}
.clans-top-page > * { position: relative; z-index: 1; }

.clans-top-inner {
    max-width: 700px;
    margin: 0 auto;
}

.clans-top-page h1 {
    font-family: 'Cinzel Decorative', 'Cinzel', Georgia, serif;
    text-align: center;
    margin: 0 0 24px;
    font-size: 2rem;
    font-weight: 700;
    color: #d4a84b;
    text-shadow: 0 0 20px rgba(212,168,75,0.3), 0 2px 4px rgba(0,0,0,0.5);
    letter-spacing: 0.08em;
}

.clans-top-nav {
    display: flex;
    gap: 10px;
    margin-bottom: 24px;
}
.clans-top-nav a {
    color: #d4a84b;
    text-decoration: none;
    font-weight: bold;
    padding: 10px 18px;
    background: linear-gradient(145deg, #4a3520 0%, #3d2914 100%);
    border: 2px solid #5c4033;
    border-radius: 4px;
    font-family: 'Cinzel', Georgia, serif;
    font-size: 0.9rem;
    letter-spacing: 0.04em;
    transition: color 0.2s, border-color 0.2s;
}
.clans-top-nav a:hover {
    color: #e8c86a;
    border-color: #8b6914;
}

.clans-table-wrap {
    background: linear-gradient(145deg, #4a3520 0%, #3d2914 100%);
    border: 2px solid #5c4033;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: inset 0 1px 0 rgba(212,168,75,0.12), 0 4px 12px rgba(0,0,0,0.35);
}

.clan-row {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 14px 18px;
    border-bottom: 1px solid rgba(92,64,51,0.6);
    cursor: pointer;
    transition: background 0.2s;
}
.clan-row:last-child { border-bottom: none; }
.clan-row:hover {
    background: rgba(61,41,20,0.6);
}
.clan-row.expanded {
    background: rgba(44,24,16,0.8);
}
.clan-row.expanded + .clan-members-row {
    display: block;
}

.clan-flag {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #5c4033;
    flex-shrink: 0;
    background: #2c1810;
}
.clan-flag-placeholder {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: #2c1810;
    border: 2px solid #5c4033;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    flex-shrink: 0;
}
.clan-main {
    flex: 1;
    min-width: 0;
}
.clan-name {
    font-family: 'Cinzel', Georgia, serif;
    font-weight: bold;
    font-size: 1.1rem;
    color: #e8dcc4;
}
.clan-territories {
    font-size: 0.9rem;
    color: #d4a84b;
    margin-top: 2px;
}
.clan-expand-icon {
    color: #d4a84b;
    font-size: 1.2rem;
    transition: transform 0.2s;
}
.clan-row.expanded .clan-expand-icon {
    transform: rotate(180deg);
}

.clan-members-row {
    display: none;
    background: rgba(28,18,10,0.9);
    border-bottom: 1px solid rgba(92,64,51,0.6);
    padding: 16px 18px 20px 78px;
}
.clan-members-row:last-of-type { border-bottom: none; }

.clan-members-title {
    font-family: 'Cinzel', Georgia, serif;
    font-size: 0.85rem;
    color: #d4a84b;
    margin-bottom: 12px;
    letter-spacing: 0.05em;
}

.clan-member {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 0;
    border-bottom: 1px solid rgba(92,64,51,0.3);
}
.clan-member:last-child { border-bottom: none; }

.clan-member-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #5c4033;
    flex-shrink: 0;
    background: #2c1810;
}
.clan-member-avatar-placeholder {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #2c1810;
    border: 2px solid #5c4033;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    flex-shrink: 0;
}
.clan-member-info { flex: 1; min-width: 0; }
.clan-member-name { font-weight: bold; color: #e8dcc4; }
.clan-member-level { font-size: 0.85rem; color: #b8a088; }
.clan-member-stats { font-size: 0.8rem; color: #d4a84b; }

.clans-empty {
    text-align: center;
    padding: 40px 20px;
    color: #b8a088;
    font-style: italic;
}

@media (max-width: 600px) {
    .clans-top-page { padding: 12px; }
    .clans-top-page h1 { font-size: 1.4rem; }
    .clan-members-row { padding-left: 18px; }
    .clan-row { padding: 12px 14px; }
}
</style>
{% endblock %}

{% block content %}
<div class="clans-top-page">
<div class="clans-top-inner">
    <h1>–¢–æ–ø –∫–ª–∞–Ω–æ–≤</h1>
    <nav class="clans-top-nav">
        <a href="{{ url_for('territory_battle_page') }}">‚Üê –ë–∏—Ç–≤–∞ –∑–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é</a>
        <a href="{{ url_for('cabinet') }}">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
    </nav>

    <div class="clans-table-wrap">
        {% if clans_data %}
        {% for clan in clans_data %}
        <div class="clan-row" data-clan-id="{{ clan.id }}" onclick="toggleClan(this)">
            {% if clan.flag_url %}
            <img src="{{ clan.flag_url }}" alt="" class="clan-flag">
            {% else %}
            <div class="clan-flag-placeholder">üè¥</div>
            {% endif %}
            <div class="clan-main">
                <div class="clan-name">{{ clan.name }}</div>
                <div class="clan-territories">–û–±–ª–∞—Å—Ç–µ–π: {{ clan.territory_count }}</div>
            </div>
            <span class="clan-expand-icon">‚ñº</span>
        </div>
        <div class="clan-members-row" data-clan-id="{{ clan.id }}">
            <div class="clan-members-title">–¢–æ–ø-10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
            {% for m in clan.members %}
            <div class="clan-member">
                {% if m.avatar_url %}
                <img src="{{ m.avatar_url }}" alt="" class="clan-member-avatar">
                {% else %}
                <div class="clan-member-avatar-placeholder">üë§</div>
                {% endif %}
                <div class="clan-member-info">
                    <div class="clan-member-name">{{ m.character_name }}</div>
                    <div class="clan-member-level">–£—Ä. {{ m.level }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
        {% else %}
        <div class="clans-empty">–ü–æ–∫–∞ –Ω–µ—Ç –∫–ª–∞–Ω–æ–≤, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏—Ö –æ–±–ª–∞—Å—Ç–∏.</div>
        {% endif %}
    </div>
</div>
</div>

<script>
function toggleClan(rowEl) {
    rowEl.classList.toggle('expanded');
}
</script>
{% endblock %}
